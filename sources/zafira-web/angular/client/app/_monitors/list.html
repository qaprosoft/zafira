<div class="page page-dashboard" data-ng-controller="MonitorsController">

    <div>
        <div class="row">
            <div class="col-lg-12">
                <h2 class="section-header">Monitors
                    <small data-ng-if="monitors.length">({{monitors.length}})</small>
                </h2>
            </div>
        </div>
        <md-fab-speed-dial id="main-fab" md-direction="up" class="md-scale md-fab-bottom-right">
            <md-fab-trigger>
                <md-button aria-label="menu" class="md-fab md-primary" md-visible="tooltipVisible">
                    <span class="fa fa-bars"></span>
                </md-button>
            </md-fab-trigger>
            <md-fab-actions>
                <md-button aria-label="menu" class="md-fab md-raised md-fab-sm" ng-click="openMonitorDialog($event)">
                    <span class="fa fa-plus"></span>
                </md-button>
            </md-fab-actions>
        </md-fab-speed-dial>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-4" data-ng-repeat="monitor in monitors | orderBy:'name'">
                    <div class="card bg-white">
                        <div style="min-height: 800px" class="card-content">
                            <i ng-class="{'highlight_green': monitor.active, 'highlight_gray': !monitor.active}" class="material-icons material-icon-16px">fiber_manual_record</i>
                            <span class="card-title">
                                {{ monitor.name }}
                            </span>
                            <md-input-container style="float: right; margin: 0; padding: 0">
                                <md-switch style="margin: 0; padding: 0" class="md-primary" ng-change="updateMonitor(monitor, true)" ng-model="monitor.active" aria-label="notif-switch"></md-switch>
                            </md-input-container>
                            <div layout layout-sm="column" style="padding: 0">
                                <md-input-container flex>
                                    <label>Name</label>
                                    <input type="text" ng-model="monitor.name" required/>
                                </md-input-container>
                            </div>
                            <div layout layout-sm="column" style="padding: 0">
                                <md-input-container flex>
                                    <label>URL</label>
                                    <input type="text" data-ng-model="monitor.url" required/>
                                </md-input-container>
                            </div>
                            <div layout layout-sm="column" style="padding: 0">
                                <md-input-container flex>
                                    <md-select ng-model="monitor.type" name="type" placeholder="Type" ng-required>
                                        <md-option value="" disabled>Type</md-option>
                                        <md-option value="HTTP">HTTP</md-option>
                                        <md-option value="PING" disabled>Ping (Next feature)</md-option>
                                    </md-select>
                                </md-input-container>
                            </div>
                            <md-radio-group id="httpMethods" ng-model="monitor.httpMethod" ng-if="isHttpBlockPresent(monitor)">
                                <md-radio-button class="checkbox-inline md-primary" value="POST">POST</md-radio-button>
                                <md-radio-button class="checkbox-inline md-primary" value="GET">GET</md-radio-button>
                                <md-radio-button class="checkbox-inline md-primary" value="PUT">PUT</md-radio-button>
                                <md-radio-button class="checkbox-inline md-primary" value="DELETE">DELETE</md-radio-button>
                            </md-radio-group>
                            <div layout layout-sm="column" ng-if="isHttpBodyBlockPresent(monitor)" style="padding: 0">
                                <span>Body</span>
                                <md-input-container flex>
                                    <code-textarea id="requestBody" ng-model="monitor.requestBody" code-data="{{monitor.requestBody}}"></code-textarea>
                                </md-input-container>
                            </div>
                            <div layout layout-sm="column" style="padding: 0">
                                <md-input-container flex>
                                    <label>Cron expression</label>
                                    <input name="value" type="text" data-ng-model="monitor.cronExpression" required/>
                                </md-input-container>
                            </div>
                            <div layout layout-sm="column" style="padding: 0">
                                <md-input-container flex>
                                    <label>Expected code</label>
                                    <input name="value" type="number" data-ng-model="monitor.expectedResponseCode" required/>
                                </md-input-container>
                            </div>
                            <div layout layout-sm="column" style="padding: 0">
                                <md-input-container flex>
                                    <label ng-if="monitor.emailList">Recepients ({{monitor.emailList.length}})</label>
                                    <md-chips ng-model="monitor.emailList"
                                              filter-selected=true
                                              md-autocomplete-snap
                                              md-transform-chip="checkAndTransformRecipient($chip, monitor)"
                                              md-on-remove="removeRecipient($chip, monitor)"
                                              md-separator-keys="keys">
                                        <md-chip-template>
                                            {{$chip}}
                                        </md-chip-template>
                                        <md-autocomplete
                                            md-autoselect
                                            md-no-cache=true
                                            md-search-text="searchText"
                                            md-items="user in querySearch(searchText, monitor)"
                                            md-item-text="user.email"
                                            placeholder="add email">
                                            <md-item-template>
                                                <span>{{user.email}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No users matching "{{searchText}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </md-chips>
                                </md-input-container>
                            </div>
                        </div>
                        <div class="card-action text-right" style="border-top: none;">
                            <md-button ng-click="deleteMonitor(monitor.id)" class="md-raised btn-w-md md-warn">Delete</md-button>
                            <md-button ng-click="updateMonitor(monitor, false)" class="md-raised btn-w-md md-primary">Save</md-button><div class="divider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
